# Краткая сводка анализа каталога товаров

## Основные цифры

- **Всего товаров:** 861
- **Уникальных товаров:** 713 (148 дубликатов из-за разных единиц измерения)
- **Категорий (групп):** 30
- **Колонок:** 34

## Ключевые поля для поиска

### ✅ Обязательные поля (100% заполнены)

| Поле | Уникальных | Назначение |
|------|------------|------------|
| `item_code` | 713 | Уникальный ID товара |
| `item_name` | 713 | Короткое название |
| `group_name` | 30 | Категория товара |
| `group_code` | 30 | Код категории |

### ✅ Основные поля для BM25 (95-100% заполнены)

| Поле | Заполнено | Уникальных | Что содержит |
|------|-----------|------------|--------------|
| `Наименованиедлясайта` | 97% | 659 | **Лучшее поле** - нормализованные названия |
| `Наименование` | 99.7% | 710 | Полное русское название |
| `Видпиломатериала` | 99.7% | 22 | Тип: Доска, Брус, Вагонка, и т.д. |
| `Порода` | 98.1% | 6 | хвоя, лиственница, осина, липа, сосна, ель |
| `Сорт` | 95.3% | 11 | класс АВ, класс С, сорт 1 ГОСТ, и т.д. |

### ✅ Размеры (99.7% заполнены)

| Поле | Уникальных | Примеры значений |
|------|------------|------------------|
| `Толщина` | 36 | 12, 13, 14, 16, 18, 20, 25, 28, 36, 40, 45, 50 |
| `Ширина` | 30 | 90, 100, 110, 115, 140, 150, 180, 200 |
| `Длина` | 15 | 1500, 2000, 2500, 2700, 3000, 4000, 6000 |

### ✅ Характеристики (98% заполнены)

| Поле | Уникальных | Значения |
|------|------------|----------|
| `Влажность` | 3 | сухой 12-14%, естественной влажности 23-65%, сырой 23-65% |
| `Типобработки` | 2 | строганый, обрезной |
| `Цена` | 92 | 11000, 22000, 23000, 26000, 27000 |
| `Остаток` | 198 | "По предзаказу" (585), числовые значения |

## Пустые поля (игнорировать)

### ❌ Полностью пустые
- `Код` - 100% пусто
- `Дополнительнаяедизмерения3Общие` - 100% пусто

### ⚠️ Почти пустые (не использовать)
- `РегионОбщие` - 99.77% пусто (только 2 записи)
- `СпециальныеценыОбщие` - 99.54% пусто (только 4 записи)
- `Допсвойство` - 99.19% пусто (только 7 записей)
- `Класс` - 79.33% пусто (дублирует `Сорт`)

## Уникальные значения по категориям

### Типы пиломатериалов (22 типа)
Доска, Брус, Брусок, Вагонка штиль, Евровагонка, Европол, Имитация бруса, Блок Хаус, Планкен прямой, Планкен скошенный, Палубная доска, и др.

### Породы дерева (6 типов)
- **хвоя** - 664 товара (77%)
- **лиственница** - 79 товаров (9%)
- **осина** - 44 товара (5%)
- липа, сосна, ель - остальные

### Классы качества (11 типов)
- **класс АВ** - 367 товаров (43%)
- **сорт 1, ГОСТ, свежий лес** - 191 товар (22%)
- класс С, класс А, класс Экстра, класс Прима, и др.

### Длина (15 вариантов)
- **6000 мм** - 523 товара (61%)
- **3000 мм** - 216 товаров (25%)
- 2500, 2700, 4000, 5000, 7000, и др.

## Рекомендации для индексации

### 1. Поисковый текст (объединить поля)

```
Наименованиедлясайта + item_name + Наименование + Видпиломатериала + Порода + Сорт
```

**Почему:** `Наименованиедлясайта` содержит нормализованные термины ("строганая" вместо "стр."), что улучшает поиск.

### 2. Метаданные для фильтрации

```python
{
    "type": "Видпиломатериала",      # Доска, Брус, Вагонка
    "species": "Порода",             # хвоя, липа, осина
    "grade": "Сорт",                 # класс АВ, класс С
    "moisture": "Влажность",         # сухой, естественной влажности
    "treatment": "Типобработки",     # строганый, обрезной
    "thickness": float,              # 13, 14, 16, 20...
    "width": float,                  # 90, 100, 140, 150...
    "length": float,                 # 3000, 6000...
    "price": float,                  # 22000, 26000...
    "stock": str,                    # "По предзаказу" или число
}
```

### 3. Веса полей для BM25

```python
{
    "Наименованиедлясайта": 3.0,  # Высокий вес
    "item_name": 2.5,              # Высокий вес
    "Наименование": 2.0,           # Средний вес
    "Видпиломатериала": 1.5,       # Средний вес
    "Порода": 1.0,                 # Низкий вес
    "Сорт": 1.0,                   # Низкий вес
}
```

## Примеры запросов для обучения агента

### Точный поиск
- **Запрос:** "вагонка 13х115х6000 класс АВ"
- **Ожидание:** Точное совпадение по размерам и классу

### Поиск по типу
- **Запрос:** "вагонка для бани"
- **Ожидание:** Вагонка из липы или осины (подходит для бани)

### Поиск по размеру
- **Запрос:** "брус 150х150"
- **Ожидание:** Брус с шириной и толщиной 150мм

### Поиск по цене
- **Запрос:** "вагонка до 25000 рублей"
- **Ожидание:** Фильтрация по цене <= 25000

### Комбинированный
- **Запрос:** "сухая строганая доска хвоя 6 метров"
- **Ожидание:** 
  - Влажность: "сухой 12-14%"
  - Обработка: "строганый"
  - Порода: "хвоя"
  - Длина: 6000

## Синонимы для нормализации

```python
SYNONYMS = {
    "вагонка": ["вагонка штиль", "евровагонка"],
    "хвоя": ["сосна", "ель", "хвоя"],
    "сухой": ["сухой 12-14%"],
    "строганый": ["строганая", "стр."],
    "6м": ["6000", "6 метров"],
    "3м": ["3000", "3 метра"],
}
```

## Проблемы данных

### Дубликаты
- **148 дубликатов** (17.19%) - одинаковые `item_code`
- **Причина:** Разные единицы измерения (м², м³, шт)
- **Решение:** При индексации объединять или помечать единицу измерения

### Неполные записи
- **3 записи** без основных полей (`Наименование`, `Цена`, `Остаток`)
- **Решение:** Исключить из индексации или обработать отдельно

## Следующие шаги

1. ✅ Анализ данных - **выполнено**
2. ⏳ Создание BM25 индексатора
3. ⏳ Интеграция в `search_products` tool
4. ⏳ Тестирование на реальных запросах
5. ⏳ Оптимизация весов и фильтров

## Файлы отчета

- `catalog_analysis_report.json` - Полный JSON отчет
- `catalog_analysis_report.md` - Детальный Markdown отчет
- `CATALOG_BM25_INDEXING_GUIDE.md` - Руководство по индексации
- `CATALOG_ANALYSIS_SUMMARY_RU.md` - Эта краткая сводка
