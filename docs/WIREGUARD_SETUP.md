# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WireGuard –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ 1C API

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ WireGuard –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ 1C API –≤–æ–∑–Ω–∏–∫–∞–ª –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å VPN —Å–µ—Ä–≤–µ—Ä–æ–º 3x-ui, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–æ–π –∂–µ –º–∞—à–∏–Ω–µ. –ö–ª–∏–µ–Ω—Ç—ã —Ç–µ—Ä—è–ª–∏ –¥–æ—Å—Ç—É–ø –∫ 3x-ui VPN.

## –ü—Ä–∏—á–∏–Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WireGuard –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞–ª–∞ –≤—Å—é –ø–æ–¥—Å–µ—Ç—å `10.66.33.0/24`, —á—Ç–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–æ —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π 3x-ui VPN —Å–µ—Ä–≤–µ—Ä–∞.

## –†–µ—à–µ–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å WireGuard —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞–ª **—Ç–æ–ª—å–∫–æ** —Ç—Ä–∞—Ñ–∏–∫ –∫ 1C —Å–µ—Ä–≤–µ—Ä—É (172.16.77.34), –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—è –¥—Ä—É–≥–∏–µ —Å–µ—Ç–∏.

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ WireGuard

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/wireguard/prg1c.conf`:

```bash
sudo nano /etc/wireguard/prg1c.conf
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:

```ini
[Interface]
PrivateKey = ODpLsu5x7pxoyYliEwY/rgZFFmGRAtVDNLdWIHGJKGw=
Address = 10.66.33.59/32,fd42:42:42::59/128
# DNS –æ—Ç–∫–ª—é—á–µ–Ω, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º DNS
Table = auto

[Peer]
PublicKey = XP3hpB6s7mxX1lsU3+565gjHnGi8nWy11LVxC/c3D1I=
PresharedKey = yNRMc7TXoO+H7Qpx6xELRXpPWXjWpQ6qCHOfxdLIeQo=
Endpoint = 176.106.242.231:64666
# –¢–æ–ª—å–∫–æ IP 1C —Å–µ—Ä–≤–µ—Ä–∞, –±–µ–∑ –≤—Å–µ–π –ø–æ–¥—Å–µ—Ç–∏
AllowedIPs = 172.16.77.34/32
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `AllowedIPs = 172.16.77.34/32` - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ IP 1C —Å–µ—Ä–≤–µ—Ä–∞
- `Table = auto` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- DNS –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω - –Ω–µ –ª–æ–º–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π DNS resolver

---

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WireGuard

#### –í–∫–ª—é—á–∏—Ç—å VPN –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ 1C:
```bash
sudo wg-quick up prg1c
```

#### –û—Ç–∫–ª—é—á–∏—Ç—å VPN:
```bash
sudo wg-quick down prg1c
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```bash
sudo wg show prg1c
```

–í—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π handshake:
```
interface: prg1c
  public key: ZW0c6QF/ghawyFyq/gOR6YxtXvNl2e7qTk3ODrVlZDE=
  private key: (hidden)
  listening port: 60955

peer: XP3hpB6s7mxX1lsU3+565gjHnGi8nWy11LVxC/c3D1I=
  endpoint: 176.106.242.231:64666
  allowed ips: 172.16.77.34/32
  latest handshake: X seconds ago
  transfer: X KiB received, X KiB sent
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã:
```bash
ip route show | grep prg1c
```

–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–∞—Ä—à—Ä—É—Ç:
```
172.16.77.34 dev prg1c scope link
```

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ 1C —Å–µ—Ä–≤–µ—Ä—É:
```bash
ping -c 3 172.16.77.34
```

–î–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –æ—Ç–≤–µ—Ç—ã —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π ~50-100ms.

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ 3x-ui —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
sudo ss -tulpn | grep -E ':(2096|45893)'
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã –ø–æ—Ä—Ç—ã:
- **2096** - VPN –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (xray)
- **45893** - –≤–µ–±-–ø–∞–Ω–µ–ª—å 3x-ui

#### –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ 1C API:
```bash
curl -u "username:password" http://172.16.77.34:port/hs/api/endpoint
```

---

### 4. –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã WireGuard –∑–∞–ø—É—Å–∫–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã:

```bash
# –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl enable wg-quick@prg1c

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ–π—á–∞—Å
sudo systemctl start wg-quick@prg1c

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status wg-quick@prg1c
```

–î–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:
```bash
sudo systemctl disable wg-quick@prg1c
sudo systemctl stop wg-quick@prg1c
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë—ã–ª–æ (–∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è) | –°—Ç–∞–ª–æ (—Ä–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è) | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|---------------------------|------------------------|---------|
| `AllowedIPs` | `10.66.33.0/24,172.16.77.34/32` | `172.16.77.34/32` | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 1C, –Ω–µ –≤—Å—è –ø–æ–¥—Å–µ—Ç—å |
| `DNS` | `DNS = 1.1.1.1,1.0.0.1` | –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ | –ù–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å systemd-resolved |
| `Table` | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | `Table = auto` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ |

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**: WireGuard –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–∞–∫–µ—Ç—ã –∫ 172.16.77.34
2. **–ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å 3x-ui**: –ü–æ–¥—Å–µ—Ç—å 10.66.33.0/24 –Ω–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ WireGuard
3. **–°–∏—Å—Ç–µ–º–Ω—ã–π DNS**: –ù–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è DNS, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π resolver

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç**:

1. ‚úÖ **3x-ui VPN —Å–µ—Ä–≤–µ—Ä** - –∫–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è
2. ‚úÖ **WireGuard –∫–ª–∏–µ–Ω—Ç** - –¥–æ—Å—Ç—É–ø –∫ 1C API
3. ‚úÖ **–ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** - –º–∞—Ä—à—Ä—É—Ç—ã –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ñ–∏–≥ —Å `AllowedIPs = 10.66.33.0/24` - –æ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å 3x-ui
2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ** –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å 3x-ui VPN –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è WireGuard
3. **–û—Ç–∫–ª—é—á–∞–π—Ç–µ** WireGuard –∫–æ–≥–¥–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å 1C API
4. **–•—Ä–∞–Ω–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –≤ —Å–µ–∫—Ä–µ—Ç–µ** - –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –∏—Ö –≤ –ø—É–±–ª–∏—á–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

## üì± –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### 3x-ui –≤–µ–±-–ø–∞–Ω–µ–ª—å
```
URL: http://138.124.71.96:45893/bxvimLA0Y4PCWqovKx/
–ü–æ—Ä—Ç: 45893
–ü—É—Ç—å: /bxvimLA0Y4PCWqovKx/
```

### 1C API —Å–µ—Ä–≤–µ—Ä
```
IP: 172.16.77.34
–î–æ—Å—Ç—É–ø: —á–µ—Ä–µ–∑ WireGuard VPN
```

### –°–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
```
ens3: 138.124.71.96/24 (–æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
prg1c: 10.66.33.59/32 (WireGuard –¥–ª—è 1C)
```

---

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### WireGuard –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
sudo journalctl -u wg-quick@prg1c -n 50

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
sudo wg-quick down prg1c
sudo wg-quick up prg1c
```

### 3x-ui VPN –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è WireGuard

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã
ip route show

# –ï—Å–ª–∏ –µ—Å—Ç—å –ª–∏—à–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã 10.66.33.0/24 —á–µ—Ä–µ–∑ prg1c - –æ—Ç–∫–ª—é—á–∏—Ç—å WireGuard
sudo wg-quick down prg1c

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ (AllowedIPs –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ 172.16.77.34/32)
sudo nano /etc/wireguard/prg1c.conf

# –í–∫–ª—é—á–∏—Ç—å —Å–Ω–æ–≤–∞
sudo wg-quick up prg1c
```

### –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ 1C API

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å handshake
sudo wg show prg1c

# –ï—Å–ª–∏ handshake —Å—Ç–∞—Ä—ã–π (>2 –º–∏–Ω—É—Ç—ã) - –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint
ping 176.106.242.231

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å WireGuard
sudo wg-quick down prg1c && sudo wg-quick up prg1c
```

### 3x-ui —Å–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status x-ui

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl start x-ui

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl restart x-ui
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [WireGuard Quick Start](https://www.wireguard.com/quickstart/)
- [3x-ui Documentation](https://github.com/MHSanaei/3x-ui)
- [1C Integration Design](./1C_INTEGRATION_DESIGN.md)
- [1C API Quick Reference](./1C_API_QUICK_REFERENCE.md)
