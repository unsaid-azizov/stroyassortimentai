# Universal Product Search - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ –≥—Ä—É–ø–ø

## –ü—Ä–æ–±–ª–µ–º–∞

–í 1–° –∫–∞—Ç–∞–ª–æ–≥–µ –≥—Ä—É–ø–ø—ã —Ä–∞–∑–º–µ—á–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–∞–∑–≤–∞–Ω–∏—é –≥—Ä—É–ø–ø—ã. –ù–∞–ø—Ä–∏–º–µ—Ä:
- –ì—Ä—É–ø–ø–∞ "–í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å" –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—Ä—É—Å –∏–ª–∏ –¥–æ—Å–∫–∏
- –ì—Ä—É–ø–ø–∞ "–ê–í –∫–ª–∞—Å—Å" –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –∫–ª–∞—Å—Å–∞ –°

**–î–≤—É—Ö—à–∞–≥–æ–≤—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –≥—Ä—É–ø–ø—ã –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç** –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ!

## –†–µ—à–µ–Ω–∏–µ: –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —Ç–æ–≤–∞—Ä–∞–º –Ω–∞–ø—Ä—è–º—É—é

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –§–æ–Ω–æ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ):    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ 1. GET /GetGroups ‚Üí –≤—Å–µ 30 –≥—Ä—É–ø–ø, 861 —Ç–æ–≤–∞—Ä           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 2. Flatten –≤ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤:                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    [                                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      {                                                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ        "item_code": "00-00010232",                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ        "item_name": "–í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å 13—Ö115—Ö6000 –°",   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ        "group_code": "00-00010036",                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ        "group_name": "–í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å"                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      },                                               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      ...                                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ]                                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Redis: "1c:catalog:flat" (TTL 1 —á–∞—Å)   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ö–ª–∏–µ–Ω—Ç: "–≤–∞–≥–æ–Ω–∫–∞ 6 –º–µ—Ç—Ä–æ–≤ –∫–ª–∞—Å—Å –ê–í"                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  search_products(query="–≤–∞–≥–æ–Ω–∫–∞ 6–º –ê–í", limit=20)           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ 1. –ü–æ–ª—É—á–∏—Ç—å flat —Å–ø–∏—Å–æ–∫ –∏–∑ Redis (861 —Ç–æ–≤–∞—Ä)          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è query:                                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    - "6–º" ‚Üí "6000"                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    - "–µ–≤—Ä–æ–≤–∞–≥–æ–Ω–∫–∞" ‚Üí "–≤–∞–≥–æ–Ω–∫–∞"                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 3. –ò–∑–≤–ª–µ—á—å keywords: ["–≤–∞–≥–æ–Ω–∫–∞", "6000", "–∞–≤"]        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 4. Keyword search –ü–û –í–°–ï–ú —Ç–æ–≤–∞—Ä–∞–º:                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    - Exact match: +10 –±–∞–ª–ª–æ–≤                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    - Partial match: +5 –±–∞–ª–ª–æ–≤                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    - –ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤: +3 –±–∞–ª–ª–∞                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 5. –¢–æ–ø-20 —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ score                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 6. –ò–∑–≤–ª–µ—á—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ group_codes                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 7. POST /GetItems –¥–ª—è –¶–ï–ù (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å!)              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ 8. –í–µ—Ä–Ω—É—Ç—å: —Ç–æ–≤–∞—Ä—ã —Å —Ü–µ–Ω–∞–º–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
        –ê–≥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ø-20 —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  get_product_details(item_codes=["00-123", "00-456"])       ‚îÇ
‚îÇ  (POST /GetDetailedItems - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø
- –ò—â–µ—Ç –ø–æ **–≤—Å–µ–º —Ç–æ–≤–∞—Ä–∞–º –Ω–∞–ø—Ä—è–º—É—é**, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É
- –ù–∞—Ö–æ–¥–∏—Ç —Ç–æ–≤–∞—Ä –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –≤ "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π" –≥—Ä—É–ø–ø–µ

### ‚úÖ –û–¥–∏–Ω tool –≤—ã–∑–æ–≤ –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö
- –ê–≥–µ–Ω—Ç—É –ø—Ä–æ—â–µ - –æ–¥–∏–Ω `search_products` –≤–º–µ—Å—Ç–æ `search_product_groups` + `get_category_items`
- –ú–µ–Ω—å—à–µ reasoning steps ‚Üí –¥–µ—à–µ–≤–ª–µ –∏ –±—ã—Å—Ç—Ä–µ–µ

### ‚úÖ –£–º–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
```python
"–≤–∞–≥–æ–Ω–∫–∞ 6–º –∫–ª–∞—Å—Å –ê–í"  ‚Üí  ["–≤–∞–≥–æ–Ω–∫–∞", "6000", "–∞–≤"]
"–±—Ä—É—Å 150x150"         ‚Üí  ["–±—Ä—É—Å", "150", "150"]
"–µ–≤—Ä–æ–≤–∞–≥–æ–Ω–∫–∞"          ‚Üí  ["–≤–∞–≥–æ–Ω–∫–∞"]
```

### ‚úÖ –ë—ã—Å—Ç—Ä–æ –∏ –¥–µ—à–µ–≤–æ
- Keyword search –ø–æ 861 —Ç–æ–≤–∞—Ä—É –≤ –ø–∞–º—è—Ç–∏: **1-5ms**
- –ë–µ–∑ RAG, –±–µ–∑ embeddings API
- –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ 1–° GetItems –¥–ª—è —Ü–µ–Ω

### ‚úÖ –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
```
–ö–ª–∏–µ–Ω—Ç: "–≤–∞–≥–æ–Ω–∫–∞ 6 –º–µ—Ç—Ä–æ–≤"

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–æ —É–±—ã–≤–∞–Ω–∏—é score):
1. –í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å 13—Ö115—Ö6000 –∫–ª–∞—Å—Å –°      (score: 25) ‚Üê exact match
2. –í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å 13—Ö140—Ö6000 –∫–ª–∞—Å—Å –ê–í     (score: 25)
3. –ï–≤—Ä–æ–≤–∞–≥–æ–Ω–∫–∞ 12,5—Ö90—Ö6000 –∫–ª–∞—Å—Å –°       (score: 20) ‚Üê —Å–∏–Ω–æ–Ω–∏–º
4. –í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å 13—Ö115—Ö3000 –∫–ª–∞—Å—Å –°      (score: 15) ‚Üê –Ω–µ—Ç "6000"
...
```

## –ê–ª–≥–æ—Ä–∏—Ç–º scoring

```python
def score_item(item_name: str, keywords: List[str]) -> float:
    score = 0.0

    for keyword in keywords:
        # Exact match (—Ü–µ–ª–æ–µ —Å–ª–æ–≤–æ)
        if f' {keyword} ' in f' {item_name.lower()} ':
            score += 10

        # Partial match (–ø–æ–¥—Å—Ç—Ä–æ–∫–∞)
        elif keyword in item_name.lower():
            score += 5

    # –ë–æ–Ω—É—Å –∑–∞ –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ (–µ—Å–ª–∏ keywords –∏–¥—É—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏)
    if keywords_in_order(item_name, keywords):
        score += 3

    # –ë–æ–Ω—É—Å –∑–∞ –∫—Ä–∞—Ç–∫–æ—Å—Ç—å (–∫–æ—Ä–æ—Ç–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–µ–µ)
    score += max(0, 50 - len(item_name)) * 0.1

    return score
```

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å:

```
User: "–ï—Å—Ç—å –ª–∏ –≤–∞–≥–æ–Ω–∫–∞ 6 –º–µ—Ç—Ä–æ–≤?"

Agent Action: search_products(query="–≤–∞–≥–æ–Ω–∫–∞ 6 –º–µ—Ç—Ä–æ–≤", limit=20, include_prices=True)

Observation: –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 12

1. –í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å —Å—Ç—Ä. —Å—É—Ö. —Ö–≤. 13—Ö115—Ö6000 –∫–ª–∞—Å—Å –° ‚Äî 11 500 ‚ÇΩ ‚Äî –í –Ω–∞–ª–∏—á–∏–∏
   –ö–æ–¥: 00-00010275
2. –í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å —Å—Ç—Ä. —Å—É—Ö. —Ö–≤. 13—Ö140—Ö6000 –∫–ª–∞—Å—Å –° ‚Äî 13 200 ‚ÇΩ ‚Äî –í –Ω–∞–ª–∏—á–∏–∏
   –ö–æ–¥: 00-00010177
3. –ï–≤—Ä–æ–≤–∞–≥–æ–Ω–∫–∞ —Å—Ç—Ä. —Å—É—Ö. —Ö–≤. 12,5—Ö90—Ö6000 –∫–ª–∞—Å—Å –° ‚Äî 11 800 ‚ÇΩ ‚Äî –í –Ω–∞–ª–∏—á–∏–∏
   –ö–æ–¥: 00-00010047
...

Agent: –î–∞, —É –Ω–∞—Å –µ—Å—Ç—å –≤–∞–≥–æ–Ω–∫–∞ 6 –º–µ—Ç—Ä–æ–≤! –ù–∞—à–µ–ª 12 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –≤–æ—Ç —Ç–æ–ø-3:

1. **–í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å 13—Ö115—Ö6000 –∫–ª–∞—Å—Å –°** - 11 500‚ÇΩ (–≤ –Ω–∞–ª–∏—á–∏–∏)
2. **–í–∞–≥–æ–Ω–∫–∞ —à—Ç–∏–ª—å 13—Ö140—Ö6000 –∫–ª–∞—Å—Å –°** - 13 200‚ÇΩ (–≤ –Ω–∞–ª–∏—á–∏–∏)
3. **–ï–≤—Ä–æ–≤–∞–≥–æ–Ω–∫–∞ 12,5—Ö90—Ö6000 –∫–ª–∞—Å—Å –°** - 11 800‚ÇΩ (–≤ –Ω–∞–ª–∏—á–∏–∏)

–ö–∞–∫–æ–π –∫–ª–∞—Å—Å –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç - –° –∏–ª–∏ –ê–í?
```

### –°–ª–æ–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:

```
User: "–ë—Ä—É—Å 150x150 —Å—É—Ö–æ–π –¥–æ 20000 —Ä—É–±–ª–µ–π"

Agent Action: search_products(query="–±—Ä—É—Å 150 150 —Å—É—Ö–æ–π", limit=20, include_prices=True)

Observation: –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 8

1. –ë—Ä—É—Å –∫–ª–µ–µ–Ω—ã–π —Å—Ç—Ä. —Å—É—Ö. —Ö–≤. 150—Ö150—Ö6000 –∫–ª–∞—Å—Å –ê–í ‚Äî 18 500 ‚ÇΩ
   –ö–æ–¥: 00-00000826
2. –ë—Ä—É—Å –æ–±—Ä–µ–∑–Ω–æ–π —Å—É—Ö–æ–π 150—Ö150—Ö6000 –ì–û–°–¢ 1 —Å–æ—Ä—Ç ‚Äî 16 200 ‚ÇΩ
   –ö–æ–¥: 00-00005502
...

Agent Thought: –ö–ª–∏–µ–Ω—Ç –∑–∞–¥–∞–ª –±—é–¥–∂–µ—Ç –¥–æ 20000‚ÇΩ, –Ω—É–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å
Agent: –ù–∞—à–µ–ª –±—Ä—É—Å 150—Ö150 —Å—É—Ö–æ–π –≤ –≤–∞—à–µ–º –±—é–¥–∂–µ—Ç–µ:

1. **–ë—Ä—É—Å –∫–ª–µ–µ–Ω—ã–π 150—Ö150—Ö6000 –∫–ª–∞—Å—Å –ê–í** - 18 500‚ÇΩ
2. **–ë—Ä—É—Å –æ–±—Ä–µ–∑–Ω–æ–π —Å—É—Ö–æ–π 150—Ö150—Ö6000 –ì–û–°–¢** - 16 200‚ÇΩ

–ö–ª–µ–µ–Ω—ã–π –±—Ä—É—Å –ø—Ä–æ—á–Ω–µ–µ –∏ –Ω–µ –¥–µ—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è. –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º?
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases

### –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω:

```python
results = await search_products(query="—ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª")

# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
"–¢–æ–≤–∞—Ä—ã –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º."
```

–ê–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω:
1. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å (—Å–∏–Ω–æ–Ω–∏–º—ã)
2. –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ—Ö–æ–∂–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
3. –í—ã–∑–≤–∞—Ç—å `call_manager` –µ—Å–ª–∏ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å

### –ï—Å–ª–∏ –∫—ç—à –ø—É—Å—Ç (1–° –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞):

```python
# search_products –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à
# –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫

# –ê–≥–µ–Ω—Ç –≤–∏–¥–∏—Ç:
"–¢–æ–≤–∞—Ä—ã –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω—ã."

# –ò –¥–æ–ª–∂–µ–Ω —Å–∫–∞–∑–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É:
"–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –°–æ–µ–¥–∏–Ω—è—é —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º..."
call_manager(reason="–ö–∞—Ç–∞–ª–æ–≥ 1–° –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
```

## –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (TTL):
- –ö—ç—à "1c:catalog:flat" –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è GetGroups

### –†—É—á–Ω–∞—è (—á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É):
```python
# –í CRM –∞–¥–º–∏–Ω–∫–µ –∫–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥"
# POST /api/admin/catalog/refresh

async def refresh_catalog():
    redis = await get_redis()
    await redis.delete("1c:catalog:flat")
    # –°–ª–µ–¥—É—é—â–∏–π search_products –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –∫—ç—à
```

### –ü–æ webhook –æ—Ç 1–° (–±—É–¥—É—â–µ–µ):
```python
# POST /api/webhooks/1c/catalog-updated
# –ö–æ–≥–¥–∞ –≤ 1–° –º–µ–Ω—è–µ—Ç—Å—è –∫–∞—Ç–∞–ª–æ–≥ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à

@router.post("/webhooks/1c/catalog-updated")
async def handle_catalog_update(secret: str):
    if secret != WEBHOOK_SECRET:
        raise HTTPException(403)

    redis = await get_redis()
    await redis.delete("1c:catalog:flat")
    logger.info("–ö–∞—Ç–∞–ª–æ–≥ 1–° –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω –ø–æ webhook")
```

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```python
# –í search_products –ª–æ–≥–∏—Ä—É–µ–º:
logger.info(f"Product search: query='{query}', results={len(results)}, top_score={results[0]['score'] if results else 0}")

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:
await save_search_analytics({
    'query': query,
    'results_count': len(results),
    'user_id': user_id,
    'timestamp': datetime.now()
})
```

### –ú–µ—Ç—Ä–∏–∫–∏ –≤ dashboard:

```
üìä –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π):
- –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: 1,245
- –ó–∞–ø—Ä–æ—Å–æ–≤ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏: 1,102 (88%)
- –ó–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: 143 (12%)
- –°—Ä–µ–¥–Ω—è—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 18.5 –±–∞–ª–ª–æ–≤
- –¢–æ–ø-5 –∑–∞–ø—Ä–æ—Å–æ–≤:
  1. "–≤–∞–≥–æ–Ω–∫–∞" - 87 —Ä–∞–∑
  2. "–±—Ä—É—Å 150" - 64 —Ä–∞–∑–∞
  3. "–¥–æ—Å–∫–∞" - 52 —Ä–∞–∑–∞
  ...
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å RAG

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Keyword Search | RAG (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫) |
|----------|----------------|------------------------|
| **–¢–æ—á–Ω–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑–º–µ—Ä–æ–≤** | ‚úÖ –û—Ç–ª–∏—á–Ω–æ ("6000" exact match) | ‚ùå –ü–ª–æ—Ö–æ (embeddings –Ω–µ –ø–æ–Ω–∏–º–∞—é—Ç —á–∏—Å–ª–∞) |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ‚úÖ 1-5ms | ‚ùå 50-100ms (embedding + vector search) |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | ‚ùå $0.0001 –∑–∞ embedding –∑–∞–ø—Ä–æ—Å |
| **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** | ‚úÖ –¢–æ–ª—å–∫–æ Redis | ‚ùå Vector DB (ChromaDB, Qdrant) |
| **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** | ‚ùå –ù–µ—Ç ("–±–∞–Ω—è" ‚â† "–ª–∏–ø–∞") | ‚úÖ –î–∞ ("–æ–±—à–∏—Ç—å –±–∞–Ω—é" ‚Üí –≤–∞–≥–æ–Ω–∫–∞ –ª–∏–ø–∞) |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω–æ–Ω–∏–º–æ–≤** | ‚úÖ –í—Ä—É—á–Ω—É—é ("–µ–≤—Ä–æ–≤–∞–≥–æ–Ω–∫–∞" ‚Üí "–≤–∞–≥–æ–Ω–∫–∞") | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ embeddings |

**–í—ã–≤–æ–¥**: –î–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ (861 —Ç–æ–≤–∞—Ä, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è) **keyword search –æ–ø—Ç–∏–º–∞–ª–µ–Ω**.

RAG –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–≥–¥–∞:
- –ö–∞—Ç–∞–ª–æ–≥ > 10,000 —Ç–æ–≤–∞—Ä–æ–≤
- –ü–æ—è–≤—è—Ç—Å—è –¥–ª–∏–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- –ù—É–∂–µ–Ω —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ ("—á–µ–º –æ–±—à–∏—Ç—å –±–∞–Ω—é?")

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

–°—Ç–∞—Ä—ã–µ tools (`search_1c_products`, `get_category_items`) **–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏**:

```python
agent_tools = [
    search_products,      # ‚Üê –ù–û–í–´–ô, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π
    search_1c_products,   # ‚Üê –°–¢–ê–†–´–ô (deprecated, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)
    get_product_details,  # ‚Üê –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
]
```

–ê–≥–µ–Ω—Ç –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å `search_products` –ø–µ—Ä–≤—ã–º –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞:

```markdown
–ò–ù–°–¢–†–£–ú–ï–ù–¢–´ –î–õ–Ø –ü–û–ò–°–ö–ê –¢–û–í–ê–†–û–í:

1. **search_products** - –ò–°–ü–û–õ–¨–ó–£–ô –≠–¢–û–¢ –ò–ù–°–¢–†–£–ú–ï–ù–¢ –ü–ï–†–í–´–ú!
   - –ò—â–µ—Ç —Ç–æ–≤–∞—Ä—ã –ø–æ –≤—Å–µ–º—É –∫–∞—Ç–∞–ª–æ–≥—É
   - –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ –≥—Ä—É–ø–ø
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å —Ü–µ–Ω–∞–º–∏ —Å—Ä–∞–∑—É

   –ü—Ä–∏–º–µ—Ä—ã:
   - search_products(query="–≤–∞–≥–æ–Ω–∫–∞ 6 –º–µ—Ç—Ä–æ–≤")
   - search_products(query="–±—Ä—É—Å 150x150 —Å—É—Ö–æ–π")

2. **get_product_details** - –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –ò—Å–ø–æ–ª—å–∑—É–π –ü–û–°–õ–ï search_products –∫–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª —Ç–æ–≤–∞—Ä
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, —Ä–∞–∑–º–µ—Ä—ã, —Å—Ä–æ–∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
```

## TODO –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [x] –°–æ–∑–¥–∞—Ç—å `search_products.py` tool
- [x] –î–æ–±–∞–≤–∏—Ç—å env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è 1C API
- [x] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å tool –≤ agent.py
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥" –≤ –∞–¥–º–∏–Ω–∫—É
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è scoring –∞–ª–≥–æ—Ä–∏—Ç–º–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ø-20 –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∏–Ω–æ–Ω–∏–º–æ–≤

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2026-01-18
**–í–µ—Ä—Å–∏—è**: 1.0
**–°—Ç–∞—Ç—É—Å**: –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
