# Улучшение отображения параметров товаров

## Обзор

Добавлены все важные параметры товаров в вывод агента. Теперь агент видит полную информацию о каждом товаре.

## Что было добавлено

### До изменений
Агент видел только:
- Наименование
- Цена
- Остаток
- Релевантность (BM25 score)

### После изменений
Агент теперь видит **все важные параметры**:

**Основная информация:**
- Код товара
- Цена
- Остаток

**Параметры материала:**
- Порода (хвоя, сосна, ель и т.д.)
- Влажность (сухой 12-14%, естественная и т.д.)
- Сорт (А, В, АВ, С)
- Класс (Extra, Прима и т.д.)
- Вид (доска, брус, вагонка и т.д.)
- Обработка (строганый, нестроганый)

**Размеры:**
- Толщина (мм)
- Ширина (мм)
- Длина (мм)

**Дополнительные параметры:**
- Доп. свойство
- Плотность (кг/м³)
- Количество в 1 шт (м², м³)
- Срок производства (дней)
- Популярность ⭐

## Изменения в коде

### [backend/tools/product_search_bm25.py](../backend/tools/product_search_bm25.py#L256)

Обновлен формат вывода функции `search_products_tool`:

```python
# Основная информация
output += f"   Код: {item.get('Код', 'N/A')}\n"
output += f"   Цена: {item.get('Цена', 'N/A')} руб.\n"
output += f"   Остаток: {item.get('Остаток', 'N/A')}\n"

# Параметры материала
if pd.notna(item.get('Порода')):
    output += f"   Порода: {item.get('Порода')}\n"
if pd.notna(item.get('Влажность')):
    output += f"   Влажность: {item.get('Влажность')}\n"
if pd.notna(item.get('Сорт')):
    output += f"   Сорт: {item.get('Сорт')}\n"
if pd.notna(item.get('Класс')):
    output += f"   Класс: {item.get('Класс')}\n"

# Размеры
dimensions = []
if pd.notna(item.get('Толщина')):
    dimensions.append(f"{item.get('Толщина')}")
if pd.notna(item.get('Ширина')):
    dimensions.append(f"{item.get('Ширина')}")
if pd.notna(item.get('Длина')):
    dimensions.append(f"{item.get('Длина')}")
if dimensions:
    output += f"   Размеры (мм): {' x '.join(dimensions)}\n"

# И т.д.
```

### [backend/tools/get_product_live_details.py](../backend/tools/get_product_live_details.py#L97)

Добавлены недостающие параметры:

```python
# Характеристики
density = item.get("Плотностькгм3Общие")
extra_property = item.get("Допсвойство")
popularity = item.get("ПопулярностьОбщие")

# Дополнительная информация
qty_m2 = item.get("Количествовм2Общие")
qty_m3 = item.get("Количествовм3Общие")
qty_pack = item.get("КоличествовупаковкеОбщие")
extra_unit1 = item.get("Дополнительнаяедизмерения1")
extra_unit2 = item.get("Дополнительнаяедизмерения2")
extra_unit3 = item.get("Дополнительнаяедизмерения3Общие")
```

## Все колонки CSV каталога (34 колонки)

| # | Колонка | Используется | Описание |
|---|---------|--------------|----------|
| 1 | group_name | ✅ | Название группы товаров |
| 2 | group_code | ❌ | Код группы |
| 3 | item_code | ❌ | Код товара (старый формат) |
| 4 | item_name | ✅ | Название товара (старый формат) |
| 5 | Наименование | ✅ | Полное наименование |
| 6 | Наименованиедлясайта | ✅ | Название для сайта |
| 7 | Цена | ✅ | Цена в рублях |
| 8 | Остаток | ✅ | Количество на складе |
| 9 | Видпиломатериала | ✅ | Доска, брус, вагонка и т.д. |
| 10 | Порода | ✅ | Хвоя, сосна, ель и т.д. |
| 11 | Сорт | ✅ | А, В, АВ, С |
| 12 | Толщина | ✅ | Толщина в мм |
| 13 | Ширина | ✅ | Ширина в мм |
| 14 | Длина | ✅ | Длина в мм |
| 15 | Влажность | ✅ | Сухой 12-14%, естественная и т.д. |
| 16 | Типобработки | ✅ | Строганый, нестроганый |
| 17 | СрокпроизводстваднОбщие | ✅ | Срок изготовления в днях |
| 18 | ПопулярностьОбщие | ✅ | Рейтинг популярности |
| 19 | Дополнительнаяедизмерения1 | ✅ | Дополнительная ед.изм. 1 |
| 20 | Дополнительнаяедизмерения2 | ✅ | Дополнительная ед.изм. 2 |
| 21 | Дополнительнаяедизмерения3Общие | ✅ | Дополнительная ед.изм. 3 |
| 22 | Допсвойство | ✅ | Дополнительное свойство |
| 23 | ЕГАИСОбщие | ❌ | Данные ЕГАИС |
| 24 | Класс | ✅ | Extra, Прима и т.д. |
| 25 | Код | ✅ | Актуальный код товара |
| 26 | Количествовм2Общие | ✅ | Площадь в 1 шт (м²) |
| 27 | Количествовм3Общие | ✅ | Объем в 1 шт (м³) |
| 28 | КоличествовупаковкеОбщие | ✅ | Штук в упаковке |
| 29 | Коэфдополнительнаяедизмерения1 | ❌ | Коэффициент ед.изм. 1 |
| 30 | Коэфдополнительнаяедизмерения2 | ❌ | Коэффициент ед.изм. 2 |
| 31 | Коэфдополнительнаяедизмерения3Общие | ❌ | Коэффициент ед.изм. 3 |
| 32 | Плотностькгм3Общие | ✅ | Плотность в кг/м³ |
| 33 | РегионОбщие | ❌ | Регион (не используется) |
| 34 | СпециальныеценыОбщие | ❌ | Специальные цены (не используется) |

**Итого:** Используется **25 из 34** колонок (74%)

## Удалены несуществующие поля

Убраны ссылки на несуществующие в CSV колонки:
- ~~Профиль~~ (не существует в CSV)
- ~~Соединение~~ (не существует в CSV)

## Убрана конфиденциальная информация

Заменены упоминания внутренней системы на общие термины:
- ~~"из 1С API"~~ → "через API"
- ~~"из 1С"~~ → "из системы"
- ~~"Код 1С"~~ → "Код"

## Пример вывода

### До изменений:
```
1. Блок Хаус строганый сухой хвоя 28х140х3000 класс С
   Цена: 22000 руб.
   Остаток: По предзаказу
```

### После изменений:
```
1. Блок Хаус строганый сухой хвоя 28х140х3000 класс С
   Код: 00-00010232
   Цена: 22000 руб.
   Остаток: По предзаказу
   Порода: хвоя
   Влажность: сухой 12-14%
   Сорт: класс С
   Вид: Блок Хаус
   Обработка: строганый
   Размеры (мм): 28 x 140 x 3000
   Плотность: 450 кг/м³
   В 1 шт: 2.38 м²
   В 1 шт: 21.258 м³
   Срок производства: 7 дней
```

## Преимущества

1. **Полная информация**: Агент видит все важные характеристики товара
2. **Лучшие ответы**: Может точно отвечать на вопросы о влажности, сорте, размерах
3. **Помощь в выборе**: Может сравнивать товары по всем параметрам
4. **Прозрачность**: Клиент получает исчерпывающую информацию

## Применение изменений

Пересобрать API контейнер:

```bash
docker compose up --build -d api
```

Изменения применятся автоматически при следующем запросе к агенту.
